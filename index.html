<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система оценок</title>

    <!-- Подключение стилей -->
    <link rel="stylesheet" href="styles.css">

    <!-- Подключение Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCfII279Y-Np3by_EOAu37dUfYe7-APdZg",
            authDomain: "setevoigorod-7d5a8.firebaseapp.com",
            projectId: "setevoigorod-7d5a8",
            storageBucket: "setevoigorod-7d5a8.appspot.com",
            messagingSenderId: "777501181808",
            appId: "1:777501181808:web:2ed26464d7f4ad6c25b1b5",
            measurementId: "G-WNFHGTHGFS"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function saveGrades() {
            const inputs = document.querySelectorAll('input[type="number"], input[type="text"]');
            const grades = {};

            inputs.forEach(input => {
                const name = input.getAttribute('data-name');
                const date = input.getAttribute('data-date');
                const value = input.value;

                if (!grades[name]) {
                    grades[name] = {};
                }
                grades[name][date] = value;

                db.collection("grades").doc(name).set(grades[name])
                    .then(() => {
                        displayStatus("Оценки сохранены!", true);
                    })
                    .catch((error) => {
                        console.error("Ошибка при сохранении оценок: ", error);
                        displayStatus("Ошибка при сохранении оценок!", false);
                    });
            });
        }

        function loadGrades() {
            const inputs = document.querySelectorAll('input[type="number"], input[type="text"]');

            inputs.forEach(input => {
                const name = input.getAttribute('data-name');
                const date = input.getAttribute('data-date');

                db.collection("grades").doc(name).get().then((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        if (data[date]) {
                            input.value = data[date];
                        }
                    }
                }).catch((error) => {
                    console.error("Ошибка при загрузке оценок: ", error);
                });
            });
        }

        function displayStatus(message, success) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerText = message;
            statusDiv.style.color = success ? 'green' : 'red';
        }

        // Добавление новой строки с учеником
        function addNewStudentRow() {
            const tableBody = document.querySelector("tbody");
            const newRow = document.createElement("tr");

            newRow.innerHTML = `
                <td><input type="text" placeholder="Введите имя" data-name="new_student"></td>
                <td><input type="text" data-name="new_student" data-date="01.10.2024"></td>
                <td><input type="text" data-name="new_student" data-date="02.10.2024"></td>
                <td><input type="text" data-name="new_student" data-date="03.10.2024"></td>
                <td><input type="text" data-name="new_student" data-date="04.10.2024"></td>
            `;

            tableBody.appendChild(newRow);
        }

        window.onload = function() {
            loadGrades();
        };
    </script>
</head>
<body>

<h1>NOT REAL SGO</h1>

<!-- Логин для админа -->
<div id="login-form">
    <h2>Вход для администратора</h2>
    <label for="login">Логин:</label>
    <input type="text" id="login"><br>
    <label for="password">Пароль:</label>
    <input type="password" id="password"><br>
    <button onclick="adminLogin()">Войти</button>
    <div id="login-status"></div>
    <button id="guest-btn" onclick="guestLogin()">Войти как гость</button>
</div>

<!-- Таблица оценок -->
<div id="grades-section" style="display: none;">
    <table>
        <thead>
            <tr>
                <th>Имя Фамилия</th>
                <th>01.10.2024</th>
                <th>02.10.2024</th>
                <th>03.10.2024</th>
                <th>04.10.2024</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" value="Есаян Майя" data-name="esayan_maya"></td>
                <td><input type="text" data-name="esayan_maya" data-date="01.10.2024"></td>
                <td><input type="text" data-name="esayan_maya" data-date="02.10.2024"></td>
                <td><input type="text" data-name="esayan_maya" data-date="03.10.2024"></td>
                <td><input type="text" data-name="esayan_maya" data-date="04.10.2024"></td>
            </tr>
            <tr>
                <td><input type="text" value="Егор Баранов" data-name="egor_baranov"></td>
                <td><input type="text" data-name="egor_baranov" data-date="01.10.2024"></td>
                <td><input type="text" data-name="egor_baranov" data-date="02.10.2024"></td>
                <td><input type="text" data-name="egor_baranov" data-date="03.10.2024"></td>
                <td><input type="text" data-name="egor_baranov" data-date="04.10.2024"></td>
            </tr>
            <tr>
                <td><input type="text" value="Маша Михаил" data-name="masha_mikhail"></td>
                <td><input type="text" data-name="masha_mikhail" data-date="01.10.2024"></td>
                <td><input type="text" data-name="masha_mikhail" data-date="02.10.2024"></td>
                <td><input type="text" data-name="masha_mikhail" data-date="03.10.2024"></td>
                <td><input type="text" data-name="masha_mikhail" data-date="04.10.2024"></td>
            </tr>
        </tbody>
    </table>

    <button onclick="addNewStudentRow()">Добавить нового ученика</button>
    <button id="save-btn" onclick="saveGrades()">Сохранить оценки</button>
    <div id="status"></div>
</div>

</body>
</html>
